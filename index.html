<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rekap Absen Digital</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .floating-header {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .chart-bar {
            transition: all 0.3s ease;
        }
        
        .chart-bar:hover {
            opacity: 0.8;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full w-full bg-gray-50">
  <div class="h-full w-full overflow-auto"><!-- Welcome Screen -->
   <div id="welcome-screen" class="min-h-full flex items-center justify-center bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800 p-4">
    <div class="max-w-3xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden">
     <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white py-8 md:py-12 px-6 md:px-12 text-center">
      <div class="text-5xl md:text-7xl mb-4">
       üìã
      </div>
      <h1 class="text-3xl md:text-4xl font-bold mb-2">REKAP ABSEN DIGITAL</h1>
      <p class="text-sm md:text-base opacity-90">Sistem Informasi Kehadiran Siswa</p>
     </div>
     <div class="p-6 md:p-12">
      <div class="mb-8 text-center">
       <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-4">Selamat Datang!</h2>
       <p class="text-sm md:text-base text-gray-600 leading-relaxed">Aplikasi Rekap Absen Digital membantu Anda mengelola dan memantau data kehadiran siswa secara efektif dan efisien dengan tampilan yang informatif.</p>
      </div>
      <div class="space-y-4 mb-8">
       <div class="flex items-start space-x-3 md:space-x-4 bg-blue-50 rounded-xl p-4">
        <div class="text-2xl md:text-3xl flex-shrink-0">
         üìä
        </div>
        <div>
         <h3 class="font-bold text-gray-800 text-sm md:text-base mb-1">Data Lengkap &amp; Terstruktur</h3>
         <p class="text-xs md:text-sm text-gray-600">Lihat rekap absensi siswa dengan filter dan pencarian yang mudah</p>
        </div>
       </div>
       <div class="flex items-start space-x-3 md:space-x-4 bg-green-50 rounded-xl p-4">
        <div class="text-2xl md:text-3xl flex-shrink-0">
         üìà
        </div>
        <div>
         <h3 class="font-bold text-gray-800 text-sm md:text-base mb-1">Visualisasi Infografis</h3>
         <p class="text-xs md:text-sm text-gray-600">Statistik kehadiran yang ditampilkan dalam bentuk grafik interaktif</p>
        </div>
       </div>
       <div class="flex items-start space-x-3 md:space-x-4 bg-purple-50 rounded-xl p-4">
        <div class="text-2xl md:text-3xl flex-shrink-0">
         üì±
        </div>
        <div>
         <h3 class="font-bold text-gray-800 text-sm md:text-base mb-1">Responsif &amp; Mobile Friendly</h3>
         <p class="text-xs md:text-sm text-gray-600">Dapat diakses dari laptop, tablet, maupun smartphone</p>
        </div>
       </div>
       <div class="flex items-start space-x-3 md:space-x-4 bg-yellow-50 rounded-xl p-4">
        <div class="text-2xl md:text-3xl flex-shrink-0">
         üè´
        </div>
        <div>
         <h3 class="font-bold text-gray-800 text-sm md:text-base mb-1">Rekap Per Kelas</h3>
         <p class="text-xs md:text-sm text-gray-600">Monitor kehadiran siswa berdasarkan kelas dengan detail lengkap</p>
        </div>
       </div>
      </div><button id="enter-app" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 rounded-xl shadow-lg transition-all transform hover:scale-105 text-base md:text-lg"> Masuk ke Aplikasi ‚Üí </button>
      <div class="mt-8 pt-6 border-t border-gray-200 text-center">
       <p class="text-xs md:text-sm text-gray-500">Bimbingan dan Konseling</p>
       <p class="text-xs md:text-sm text-gray-600 font-semibold mt-1">Muhammad Hasratul</p>
      </div>
     </div>
    </div>
   </div><!-- Main Application (Hidden Initially) -->
   <div id="main-app" class="hidden"><!-- Floating Header -->
    <header class="floating-header bg-blue-600 text-white py-6 mb-8 sticky top-0 z-10">
     <div class="container mx-auto px-4">
      <div class="max-w-2xl mx-auto text-center">
       <h1 id="app-title" class="text-2xl md:text-3xl font-bold rounded-full bg-blue-700 py-3 md:py-4 px-6 md:px-8 inline-block mb-3">REKAP ABSEN DIGITAL</h1>
       <div class="text-sm md:text-base"><span id="current-day" class="font-semibold"></span>, <span id="current-date"></span>
       </div>
      </div>
     </div>
    </header>
    <main class="container mx-auto px-4 pb-20"><!-- Tab Navigation -->
     <div class="flex justify-center mb-6 space-x-2 md:space-x-4"><button id="tab-rekap" class="px-4 md:px-6 py-2 md:py-3 rounded-lg font-semibold text-sm md:text-base bg-blue-600 text-white"> Rekap Absen </button> <button id="tab-infografis" class="px-4 md:px-6 py-2 md:py-3 rounded-lg font-semibold text-sm md:text-base bg-gray-200 text-gray-700 hover:bg-gray-300"> Infografis </button>
     </div><!-- Rekap Absen Tab -->
     <div id="rekap-tab-content"><!-- Filter Section -->
      <div class="bg-white rounded-lg shadow-md p-4 md:p-6 mb-6">
       <div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 mb-4">
        <div><label class="block text-xs md:text-sm font-medium text-gray-700 mb-2">Filter Kolom</label> <select id="filter-column" class="w-full px-3 md:px-4 py-2 text-sm md:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"> <option value="">Pilih Kolom...</option> </select>
        </div>
        <div><label class="block text-xs md:text-sm font-medium text-gray-700 mb-2">Nilai Filter</label> <select id="filter-value" class="w-full px-3 md:px-4 py-2 text-sm md:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" disabled> <option value="">Pilih Nilai...</option> </select>
        </div>
        <div><label class="block text-xs md:text-sm font-medium text-gray-700 mb-2">Pencarian Cepat</label> <input type="text" id="quick-search" placeholder="Cari..." class="w-full px-3 md:px-4 py-2 text-sm md:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
       </div><button id="reset-filter" class="w-full md:w-auto px-4 md:px-6 py-2 text-sm md:text-base bg-red-500 text-white rounded-lg hover:bg-red-600 font-semibold"> Reset Filter </button>
      </div><!-- Table Controls -->
      <div class="bg-white rounded-lg shadow-md p-3 md:p-4 mb-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-3 md:gap-0">
       <div class="flex items-center"><label class="text-xs md:text-sm font-medium text-gray-700 mr-2">Tampilkan:</label> <select id="rows-per-page" class="px-2 md:px-3 py-1 md:py-2 text-xs md:text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="5">5</option> <option value="10" selected>10</option> <option value="20">20</option> <option value="50">50</option> <option value="100">100</option> <option value="all">Semua</option> </select> <span class="text-xs md:text-sm text-gray-600 ml-2">data</span>
       </div>
       <div id="data-info" class="text-xs md:text-sm text-gray-600"></div>
      </div><!-- Table -->
      <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
       <div class="table-container">
        <table class="w-full" id="data-table">
         <thead class="bg-green-600 text-white">
          <tr id="table-header"></tr>
         </thead>
         <tbody id="table-body"></tbody>
        </table>
       </div>
      </div><!-- Pagination -->
      <div class="flex justify-center items-center space-x-2" id="pagination"></div><!-- Loading State -->
      <div id="loading" class="text-center py-8">
       <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
       <p class="mt-4 text-gray-600">Memuat data...</p>
      </div>
     </div><!-- Infografis Tab -->
     <div id="infografis-tab-content" class="hidden"><!-- Summary Cards -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-6">
       <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-4 md:p-6 text-white">
        <div class="text-2xl md:text-3xl mb-1 md:mb-2">
         üë•
        </div>
        <div class="text-xl md:text-2xl font-bold" id="total-students">
         0
        </div>
        <div class="text-xs md:text-sm opacity-90">
         Total Siswa
        </div>
       </div>
       <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-4 md:p-6 text-white">
        <div class="text-2xl md:text-3xl mb-1 md:mb-2">
         ‚úì
        </div>
        <div class="text-xl md:text-2xl font-bold" id="total-hadir">
         0
        </div>
        <div class="text-xs md:text-sm opacity-90">
         Total Hadir
        </div>
       </div>
       <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl shadow-lg p-4 md:p-6 text-white">
        <div class="text-2xl md:text-3xl mb-1 md:mb-2">
         üè•
        </div>
        <div class="text-xl md:text-2xl font-bold" id="total-sakit-izin">
         0
        </div>
        <div class="text-xs md:text-sm opacity-90">
         Sakit + Izin
        </div>
       </div>
       <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl shadow-lg p-4 md:p-6 text-white">
        <div class="text-2xl md:text-3xl mb-1 md:mb-2">
         ‚úó
        </div>
        <div class="text-xl md:text-2xl font-bold" id="total-alpa">
         0
        </div>
        <div class="text-xs md:text-sm opacity-90">
         Total Alpa
        </div>
       </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6"><!-- Grafik Jenis Kelamin -->
       <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
        <h2 class="text-base md:text-xl font-bold text-gray-800 mb-3 md:mb-4 flex items-center"><span class="text-xl md:text-2xl mr-2">üë´</span> Rekap Jenis Kelamin</h2>
        <div id="gender-chart" class="flex justify-center items-center space-x-4 md:space-x-6 py-4 md:py-8"></div>
       </div><!-- Grafik Kehadiran -->
       <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
        <h2 class="text-base md:text-xl font-bold text-gray-800 mb-3 md:mb-4 flex items-center"><span class="text-xl md:text-2xl mr-2">üìä</span> Rekap Kehadiran</h2>
        <div id="attendance-summary-chart" class="py-2 md:py-4"></div>
       </div><!-- Rekap Per Kelas -->
       <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 lg:col-span-2">
        <h2 class="text-base md:text-xl font-bold text-gray-800 mb-3 md:mb-4 flex items-center"><span class="text-xl md:text-2xl mr-2">üè´</span> Rekap Per Kelas</h2>
        <div id="class-summary" class="space-y-2 md:space-y-3"></div>
       </div>
      </div>
     </div>
    </main><!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
     <div class="container mx-auto px-4">
      <div class="text-center space-y-2">
       <p id="footer-text" class="text-base md:text-lg font-semibold">¬© <span id="current-year"></span> Sistem Absensi Digital</p>
       <p class="text-sm md:text-base text-gray-300">Bimbingan dan Konseling</p>
       <p class="text-sm md:text-base text-gray-400">Muhammad Hasratul</p>
      </div>
     </div>
    </footer>
   </div><!-- End Main App --> <!-- Modal Detail Siswa -->
   <div id="student-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-backdrop absolute inset-0" id="modal-backdrop"></div>
    <div class="relative min-h-full flex items-center justify-center p-3 md:p-4">
     <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] md:max-h-[85vh] overflow-hidden transform transition-all">
      <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 md:px-8 py-4 md:py-6 flex justify-between items-center">
       <div>
        <div class="text-xs md:text-sm opacity-90 mb-1">
         üìã Detail Informasi Siswa
        </div>
        <h3 class="text-lg md:text-2xl font-bold" id="modal-title">Detail Siswa</h3>
       </div><button id="close-modal" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full w-8 h-8 md:w-10 md:h-10 flex items-center justify-center text-xl md:text-2xl font-bold transition-all">√ó</button>
      </div>
      <div class="p-4 md:p-8 overflow-y-auto max-h-[calc(90vh-100px)] md:max-h-[calc(85vh-120px)]" id="modal-content"></div>
     </div>
    </div>
   </div>
  </div>
  <script>
        const defaultConfig = {
            app_title: "REKAP ABSEN DIGITAL",
            tab_rekap_label: "Rekap Absen",
            tab_infografis_label: "Infografis",
            footer_text: "¬© 2026 Sistem Absensi Digital",
            header_color: "#2563eb",
            header_text_color: "#ffffff",
            table_header_color: "#16a34a",
            primary_action_color: "#2563eb",
            secondary_action_color: "#dc2626"
        };

        let allData = [];
        let filteredData = [];
        let currentPage = 1;
        let rowsPerPage = 10;
        let headers = [];
        let config = defaultConfig;

        async function onConfigChange(config) {
            const appTitle = document.getElementById('app-title');
            const tabRekap = document.getElementById('tab-rekap');
            const tabInfografis = document.getElementById('tab-infografis');
            const footerText = document.getElementById('footer-text');

            if (appTitle) appTitle.textContent = config.app_title || defaultConfig.app_title;
            if (tabRekap) tabRekap.textContent = config.tab_rekap_label || defaultConfig.tab_rekap_label;
            if (tabInfografis) tabInfografis.textContent = config.tab_infografis_label || defaultConfig.tab_infografis_label;
            if (footerText) footerText.textContent = config.footer_text || defaultConfig.footer_text;

            const header = document.querySelector('header');
            if (header) {
                header.style.backgroundColor = config.header_color || defaultConfig.header_color;
                header.style.color = config.header_text_color || defaultConfig.header_text_color;
            }

            const headerRound = document.querySelector('header h1');
            if (headerRound) {
                const darkerColor = adjustBrightness(config.header_color || defaultConfig.header_color, -20);
                headerRound.style.backgroundColor = darkerColor;
            }

            const tableHeader = document.querySelector('thead');
            if (tableHeader) {
                tableHeader.style.backgroundColor = config.table_header_color || defaultConfig.table_header_color;
            }

            const primaryButtons = document.querySelectorAll('#tab-rekap, #pagination button.bg-blue-600');
            primaryButtons.forEach(btn => {
                btn.style.backgroundColor = config.primary_action_color || defaultConfig.primary_action_color;
            });

            const secondaryButtons = document.querySelectorAll('#reset-filter');
            secondaryButtons.forEach(btn => {
                btn.style.backgroundColor = config.secondary_action_color || defaultConfig.secondary_action_color;
            });
        }

        function adjustBrightness(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255))
                .toString(16).slice(1);
        }

        async function loadCSVData() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQtC2sZQFm2xwBv6_oN-KhBtYU_Mdp9mNheZC7NdxmWPpoqmCApYJbKgdywPUTDxipVuZi0x9yq-BId/pub?gid=0&single=true&output=csv');
                const csvText = await response.text();
                parseCSV(csvText);
                document.getElementById('loading').classList.add('hidden');
                renderTable();
                populateFilterColumns();
                renderInfografis();
            } catch (error) {
                document.getElementById('loading').innerHTML = '<p class="text-red-600">Gagal memuat data. Silakan coba lagi.</p>';
            }
        }

        function parseCSV(csv) {
            const lines = csv.trim().split('\n').filter(line => line.trim());
            if (lines.length === 0) return;
            
            // Parse header
            const headerLine = lines[0];
            headers = parseCSVLine(headerLine);
            
            // Parse data rows
            allData = [];
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header] = values[index] || '';
                });
                allData.push(obj);
            }
            
            filteredData = [...allData];
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        function populateFilterColumns() {
            const filterColumn = document.getElementById('filter-column');
            filterColumn.innerHTML = '<option value="">Pilih Kolom...</option>';
            headers.forEach(header => {
                const option = document.createElement('option');
                option.value = header;
                option.textContent = header;
                filterColumn.appendChild(option);
            });
        }

        function renderTable() {
            const tableHeader = document.getElementById('table-header');
            const tableBody = document.getElementById('table-body');
            
            tableHeader.innerHTML = headers.map(header => 
                `<th class="px-2 md:px-4 py-2 md:py-3 text-left font-semibold text-xs md:text-sm">${header}</th>`
            ).join('') + '<th class="px-2 md:px-4 py-2 md:py-3 text-center font-semibold text-xs md:text-sm">Aksi</th>';

            const start = rowsPerPage === 'all' ? 0 : (currentPage - 1) * parseInt(rowsPerPage);
            const end = rowsPerPage === 'all' ? filteredData.length : start + parseInt(rowsPerPage);
            const pageData = filteredData.slice(start, end);

            tableBody.innerHTML = pageData.map(row => {
                const rowIndex = filteredData.indexOf(row);
                const cells = headers.map((header, index) => {
                    return `<td class="px-2 md:px-4 py-2 md:py-3 text-xs md:text-sm">${row[header]}</td>`;
                }).join('');
                return `<tr class="border-b border-gray-200 hover:bg-gray-50">${cells}<td class="px-2 md:px-4 py-2 md:py-3 text-center"><button onclick="showStudentDetail(${rowIndex})" class="text-blue-600 hover:text-blue-800 text-lg md:text-xl" title="Lihat Detail">üëÅÔ∏è</button></td></tr>`;
            }).join('');

            renderPagination();
            updateDataInfo();
        }

        function renderPagination() {
            if (rowsPerPage === 'all') {
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            const totalPages = Math.ceil(filteredData.length / parseInt(rowsPerPage));
            const pagination = document.getElementById('pagination');
            
            let html = '';
            
            if (currentPage > 1) {
                html += `<button onclick="changePage(${currentPage - 1})" class="px-3 md:px-4 py-1.5 md:py-2 text-xs md:text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700">‚Üê Prev</button>`;
            }

            const startPage = Math.max(1, currentPage - 1);
            const endPage = Math.min(totalPages, currentPage + 1);

            for (let i = startPage; i <= endPage; i++) {
                const activeClass = i === currentPage ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300';
                html += `<button onclick="changePage(${i})" class="px-3 md:px-4 py-1.5 md:py-2 text-xs md:text-sm ${activeClass} rounded-lg font-semibold">${i}</button>`;
            }

            if (currentPage < totalPages) {
                html += `<button onclick="changePage(${currentPage + 1})" class="px-3 md:px-4 py-1.5 md:py-2 text-xs md:text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700">Next ‚Üí</button>`;
            }

            pagination.innerHTML = html;
        }

        function changePage(page) {
            currentPage = page;
            renderTable();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function updateDataInfo() {
            const start = rowsPerPage === 'all' ? 1 : (currentPage - 1) * parseInt(rowsPerPage) + 1;
            const end = rowsPerPage === 'all' ? filteredData.length : Math.min(currentPage * parseInt(rowsPerPage), filteredData.length);
            document.getElementById('data-info').textContent = `Menampilkan ${start}-${end} dari ${filteredData.length} data`;
        }

        function updateDateTime() {
            const now = new Date();
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            
            const dayName = days[now.getDay()];
            const date = now.getDate();
            const month = months[now.getMonth()];
            const year = now.getFullYear();
            
            document.getElementById('current-day').textContent = dayName;
            document.getElementById('current-date').textContent = `${date} ${month} ${year}`;
            document.getElementById('current-year').textContent = year;
        }

        function showStudentDetail(index) {
            const student = filteredData[index];
            const modal = document.getElementById('student-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalContent = document.getElementById('modal-content');

            modalTitle.textContent = student[headers[0]] || 'Detail Siswa';
            
            let html = '<div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-6">';
            
            headers.forEach((header, idx) => {
                const icon = idx === 0 ? 'üë§' : idx === 1 ? 'üè´' : idx === 2 ? 'üë´' : 'üìã';
                html += `
                    <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-3 md:p-4 border border-gray-200 hover:shadow-md transition-shadow">
                        <div class="text-xs font-semibold text-gray-500 uppercase mb-2 flex items-center">
                            <span class="mr-2">${icon}</span>
                            ${header}
                        </div>
                        <div class="text-sm md:text-lg font-bold text-gray-900">${student[header] || '-'}</div>
                    </div>
                `;
            });
            html += '</div>';

            modalContent.innerHTML = html;
            modal.classList.remove('hidden');
        }

        function renderInfografis() {
            renderSummaryCards();
            renderGenderChart();
            renderAttendanceSummary();
            renderClassSummary();
        }

        function renderSummaryCards() {
            const attendanceColumns = {
                hadir: headers.find(h => h.toLowerCase().includes('hadir')),
                sakit: headers.find(h => h.toLowerCase().includes('sakit')),
                izin: headers.find(h => h.toLowerCase().includes('izin')),
                alpa: headers.find(h => h.toLowerCase().includes('alpa') || h.toLowerCase().includes('alpha'))
            };

            let totalHadir = 0, totalSakit = 0, totalIzin = 0, totalAlpa = 0;

            allData.forEach(row => {
                if (attendanceColumns.hadir) totalHadir += parseInt(row[attendanceColumns.hadir]) || 0;
                if (attendanceColumns.sakit) totalSakit += parseInt(row[attendanceColumns.sakit]) || 0;
                if (attendanceColumns.izin) totalIzin += parseInt(row[attendanceColumns.izin]) || 0;
                if (attendanceColumns.alpa) totalAlpa += parseInt(row[attendanceColumns.alpa]) || 0;
            });

            document.getElementById('total-students').textContent = allData.length;
            document.getElementById('total-hadir').textContent = totalHadir;
            document.getElementById('total-sakit-izin').textContent = totalSakit + totalIzin;
            document.getElementById('total-alpa').textContent = totalAlpa;
        }

        function renderGenderChart() {
            const genderColumn = headers.find(h => h.toLowerCase().includes('kelamin') || h.toLowerCase().includes('jk'));
            if (!genderColumn) return;

            const genderCount = {};
            allData.forEach(row => {
                const gender = row[genderColumn] || 'Tidak Diketahui';
                genderCount[gender] = (genderCount[gender] || 0) + 1;
            });

            const chartContainer = document.getElementById('gender-chart');
            const colors = { 'Laki-laki': '#3b82f6', 'Perempuan': '#ec4899', 'L': '#3b82f6', 'P': '#ec4899' };
            const icons = { 'Laki-laki': 'üë®', 'Perempuan': 'üë©', 'L': 'üë®', 'P': 'üë©' };

            let html = '';
            Object.entries(genderCount).forEach(([gender, count]) => {
                const color = colors[gender] || '#10b981';
                const icon = icons[gender] || 'üë§';
                const percentage = ((count / allData.length) * 100).toFixed(1);
                
                html += `
                    <div class="text-center">
                        <div class="text-3xl md:text-5xl mb-2 md:mb-3">${icon}</div>
                        <div class="text-2xl md:text-3xl font-bold text-gray-800">${count}</div>
                        <div class="text-xs md:text-sm font-medium text-gray-600 mt-1">${gender}</div>
                        <div class="text-xs text-gray-500 mt-1">(${percentage}%)</div>
                        <div class="mt-2 md:mt-3 w-16 md:w-24 h-2 bg-gray-200 rounded-full mx-auto">
                            <div class="h-2 rounded-full transition-all" style="width: ${percentage}%; background-color: ${color};"></div>
                        </div>
                    </div>
                `;
            });

            chartContainer.innerHTML = html;
        }

        function renderAttendanceSummary() {
            const attendanceColumns = {
                hadir: headers.find(h => h.toLowerCase().includes('hadir')),
                sakit: headers.find(h => h.toLowerCase().includes('sakit')),
                izin: headers.find(h => h.toLowerCase().includes('izin')),
                alpa: headers.find(h => h.toLowerCase().includes('alpa') || h.toLowerCase().includes('alpha'))
            };

            let totals = { hadir: 0, sakit: 0, izin: 0, alpa: 0 };

            allData.forEach(row => {
                if (attendanceColumns.hadir) totals.hadir += parseInt(row[attendanceColumns.hadir]) || 0;
                if (attendanceColumns.sakit) totals.sakit += parseInt(row[attendanceColumns.sakit]) || 0;
                if (attendanceColumns.izin) totals.izin += parseInt(row[attendanceColumns.izin]) || 0;
                if (attendanceColumns.alpa) totals.alpa += parseInt(row[attendanceColumns.alpa]) || 0;
            });

            const total = totals.hadir + totals.sakit + totals.izin + totals.alpa;
            const chartContainer = document.getElementById('attendance-summary-chart');

            const attendanceData = [
                { label: 'Hadir', value: totals.hadir, color: '#10b981', icon: '‚úì' },
                { label: 'Sakit', value: totals.sakit, color: '#f59e0b', icon: 'üè•' },
                { label: 'Izin', value: totals.izin, color: '#3b82f6', icon: 'üìù' },
                { label: 'Alpa', value: totals.alpa, color: '#ef4444', icon: '‚úó' }
            ];

            let html = '<div class="space-y-3">';
            attendanceData.forEach(item => {
                const percentage = total > 0 ? ((item.value / total) * 100).toFixed(1) : 0;
                html += `
                    <div>
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs md:text-sm font-semibold text-gray-700">${item.icon} ${item.label}</span>
                            <span class="text-xs md:text-sm font-bold text-gray-900">${item.value} (${percentage}%)</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 md:h-4">
                            <div class="h-3 md:h-4 rounded-full transition-all" style="width: ${percentage}%; background-color: ${item.color};"></div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';

            chartContainer.innerHTML = html;
        }

        function renderClassSummary() {
            const classColumn = headers.find(h => h.toLowerCase().includes('kelas'));
            const genderColumn = headers.find(h => h.toLowerCase().includes('kelamin') || h.toLowerCase().includes('jk'));
            const attendanceColumns = {
                hadir: headers.find(h => h.toLowerCase().includes('hadir')),
                sakit: headers.find(h => h.toLowerCase().includes('sakit')),
                izin: headers.find(h => h.toLowerCase().includes('izin')),
                alpa: headers.find(h => h.toLowerCase().includes('alpa') || h.toLowerCase().includes('alpha'))
            };

            if (!classColumn) return;

            const classSummary = {};
            allData.forEach(row => {
                const kelas = row[classColumn] || 'Tidak Diketahui';
                
                if (!classSummary[kelas]) {
                    classSummary[kelas] = { 
                        total: 0, 
                        gender: {}, 
                        attendance: { hadir: 0, sakit: 0, izin: 0, alpa: 0 }
                    };
                }
                
                classSummary[kelas].total++;
                
                if (genderColumn) {
                    const gender = row[genderColumn] || 'Tidak Diketahui';
                    classSummary[kelas].gender[gender] = (classSummary[kelas].gender[gender] || 0) + 1;
                }
                
                if (attendanceColumns.hadir) classSummary[kelas].attendance.hadir += parseInt(row[attendanceColumns.hadir]) || 0;
                if (attendanceColumns.sakit) classSummary[kelas].attendance.sakit += parseInt(row[attendanceColumns.sakit]) || 0;
                if (attendanceColumns.izin) classSummary[kelas].attendance.izin += parseInt(row[attendanceColumns.izin]) || 0;
                if (attendanceColumns.alpa) classSummary[kelas].attendance.alpa += parseInt(row[attendanceColumns.alpa]) || 0;
            });

            const chartContainer = document.getElementById('class-summary');
            let html = '';

            Object.entries(classSummary).sort((a, b) => a[0].localeCompare(b[0])).forEach(([kelas, data]) => {
                const genderText = Object.entries(data.gender).map(([g, c]) => `${g}: ${c}`).join(', ');
                const totalAttendance = data.attendance.hadir + data.attendance.sakit + data.attendance.izin + data.attendance.alpa;
                
                html += `
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-3 md:p-4 border border-blue-200 hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start mb-2 md:mb-3">
                            <div>
                                <h3 class="text-base md:text-lg font-bold text-gray-800">üè´ ${kelas}</h3>
                                <p class="text-xs md:text-sm text-gray-600 mt-1">üë• ${data.total} Siswa ‚Ä¢ ${genderText}</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-4 gap-1.5 md:gap-2 text-center">
                            <div class="bg-white rounded-lg p-1.5 md:p-2">
                                <div class="text-green-600 font-bold text-sm md:text-lg">${data.attendance.hadir}</div>
                                <div class="text-xs text-gray-600">Hadir</div>
                            </div>
                            <div class="bg-white rounded-lg p-1.5 md:p-2">
                                <div class="text-yellow-600 font-bold text-sm md:text-lg">${data.attendance.sakit}</div>
                                <div class="text-xs text-gray-600">Sakit</div>
                            </div>
                            <div class="bg-white rounded-lg p-1.5 md:p-2">
                                <div class="text-blue-600 font-bold text-sm md:text-lg">${data.attendance.izin}</div>
                                <div class="text-xs text-gray-600">Izin</div>
                            </div>
                            <div class="bg-white rounded-lg p-1.5 md:p-2">
                                <div class="text-red-600 font-bold text-sm md:text-lg">${data.attendance.alpa}</div>
                                <div class="text-xs text-gray-600">Alpa</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            chartContainer.innerHTML = html;
        }

        document.getElementById('filter-column').addEventListener('change', function(e) {
            const filterValue = document.getElementById('filter-value');
            filterValue.disabled = !e.target.value;
            
            if (e.target.value) {
                const uniqueValues = [...new Set(allData.map(row => row[e.target.value]))].filter(v => v);
                filterValue.innerHTML = '<option value="">Semua</option>' + 
                    uniqueValues.map(v => `<option value="${v}">${v}</option>`).join('');
            }
        });

        document.getElementById('filter-value').addEventListener('change', function(e) {
            const column = document.getElementById('filter-column').value;
            if (column && e.target.value) {
                filteredData = allData.filter(row => row[column] === e.target.value);
            } else {
                filteredData = [...allData];
            }
            currentPage = 1;
            renderTable();
        });

        document.getElementById('quick-search').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            filteredData = allData.filter(row => 
                Object.values(row).some(val => 
                    val.toString().toLowerCase().includes(searchTerm)
                )
            );
            currentPage = 1;
            renderTable();
        });

        document.getElementById('reset-filter').addEventListener('click', function() {
            document.getElementById('filter-column').value = '';
            document.getElementById('filter-value').value = '';
            document.getElementById('filter-value').disabled = true;
            document.getElementById('quick-search').value = '';
            filteredData = [...allData];
            currentPage = 1;
            renderTable();
        });

        document.getElementById('rows-per-page').addEventListener('change', function(e) {
            rowsPerPage = e.target.value;
            currentPage = 1;
            renderTable();
        });

        document.getElementById('close-modal').addEventListener('click', function() {
            document.getElementById('student-modal').classList.add('hidden');
        });

        document.getElementById('modal-backdrop').addEventListener('click', function() {
            document.getElementById('student-modal').classList.add('hidden');
        });

        document.getElementById('tab-rekap').addEventListener('click', function() {
            document.getElementById('rekap-tab-content').classList.remove('hidden');
            document.getElementById('infografis-tab-content').classList.add('hidden');
            this.classList.add('bg-blue-600', 'text-white');
            this.classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('tab-infografis').classList.remove('bg-blue-600', 'text-white');
            document.getElementById('tab-infografis').classList.add('bg-gray-200', 'text-gray-700');
        });

        document.getElementById('tab-infografis').addEventListener('click', function() {
            document.getElementById('rekap-tab-content').classList.add('hidden');
            document.getElementById('infografis-tab-content').classList.remove('hidden');
            this.classList.add('bg-blue-600', 'text-white');
            this.classList.remove('bg-gray-200', 'text-gray-700');
            document.getElementById('tab-rekap').classList.remove('bg-blue-600', 'text-white');
            document.getElementById('tab-rekap').classList.add('bg-gray-200', 'text-gray-700');
        });

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities: (config) => ({
                    recolorables: [
                        {
                            get: () => config.header_color || defaultConfig.header_color,
                            set: (value) => {
                                config.header_color = value;
                                window.elementSdk.setConfig({ header_color: value });
                            }
                        },
                        {
                            get: () => config.table_header_color || defaultConfig.table_header_color,
                            set: (value) => {
                                config.table_header_color = value;
                                window.elementSdk.setConfig({ table_header_color: value });
                            }
                        },
                        {
                            get: () => config.header_text_color || defaultConfig.header_text_color,
                            set: (value) => {
                                config.header_text_color = value;
                                window.elementSdk.setConfig({ header_text_color: value });
                            }
                        },
                        {
                            get: () => config.primary_action_color || defaultConfig.primary_action_color,
                            set: (value) => {
                                config.primary_action_color = value;
                                window.elementSdk.setConfig({ primary_action_color: value });
                            }
                        },
                        {
                            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                            set: (value) => {
                                config.secondary_action_color = value;
                                window.elementSdk.setConfig({ secondary_action_color: value });
                            }
                        }
                    ],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["app_title", config.app_title || defaultConfig.app_title],
                    ["tab_rekap_label", config.tab_rekap_label || defaultConfig.tab_rekap_label],
                    ["tab_infografis_label", config.tab_infografis_label || defaultConfig.tab_infografis_label],
                    ["footer_text", config.footer_text || defaultConfig.footer_text]
                ])
            });
            config = window.elementSdk.config;
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            onConfigChange(config);
            
            // Enter app button handler
            document.getElementById('enter-app').addEventListener('click', function() {
                document.getElementById('welcome-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                loadCSVData();
            });
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b1fd730129fb809',t:'MTc2NjQwODgyOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>

</html>
